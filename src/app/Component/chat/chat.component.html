<!-- chat.component.html -->
<div class="chat-container">
  <div class="header">
    <span class="chat-title">Talk to Me (Enayet ðŸ¤–)</span>
    <button class="new-chat-btn" (click)="startNewChat()">New Chat</button>
  </div>
  <div class="background-animation">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>
  <div class="messages-container" #messagesContainer>
    <div *ngFor="let message of messages; trackBy: trackByMessageId"
         class="message-wrapper"
         [class.user-message]="message.isUser"
         [class.ai-message]="!message.isUser">
      <div class="message-avatar" *ngIf="!message.isUser">
        <div class="avatar-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
      <div class="message-content" [class.streaming-text]="message.isStreaming">
        <div class="message-bubble" 
             [class.user-bubble]="message.isUser"
             [class.ai-bubble]="!message.isUser">
          <div class="message-text" [innerHTML]="renderMarkdown(message.content)"></div>
          <span *ngIf="message.isStreaming" class="cursor"></span>
        </div>
      </div>
    </div>
    <div *ngIf="isTyping" class="message-wrapper ai-message typing-message">
      <div class="message-avatar">
        <div class="avatar-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
      <div class="message-content">
        <div class="message-bubble ai-bubble">
          <div class="typing-indicator">
            <div class="typing-dots">
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </div>
            <span class="typing-text">Analyzing data, please wait...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="input-container">
    <div class="input-wrapper">
      <button class="attach-btn" mat-icon-button>
        <mat-icon>attach_file</mat-icon>
      </button>
      <div class="input-field">
        <textarea 
          #messageInput
          [(ngModel)]="userMessage"
          (keypress)="onKeyPress($event)"
          placeholder="Ask, write or search for anything..."
          [disabled]="isSending"
          maxlength="500"
          rows="1"></textarea>
      </div>
      <button class="send-button"
              mat-icon-button
              (click)="sendMessage()"
              [disabled]="!userMessage.trim() || isSending">
        <mat-icon>send</mat-icon>
      </button>
    </div>
  </div>
</div>